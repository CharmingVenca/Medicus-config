(
echo @echo off
echo setlocal enabledelayedexpansion
echo set "filePath=C:\Medicus 3\Medicus.ini"
echo.
echo :validateIP
echo set "ip=%%1"
echo for /f "tokens=1-4 delims=." %%%%a in ("%%ip%%") do (
echo     if "%%%%d"=="" goto invalidIP
echo     for %%%%x in (%%%%a %%%%b %%%%c %%%%d) do (
echo         set /a "num=%%%%x"
echo         if !num! lss 0 goto invalidIP
echo         if !num! gtr 255 goto invalidIP
echo     )
echo )
echo goto :eof
echo.
echo :invalidIP
echo echo Invalid IP address. Please try again.
echo exit /b 1
echo.
echo :promptIP
echo set /p "newIP=Enter the new server IP: "
echo call :validateIP %%newIP%%
echo if %%errorlevel%% neq 0 goto promptIP
echo.
echo for /f "tokens=1* delims==" %%%%a in ('findstr /b /c:"Server=" "%%filePath%%"') do (
echo     set "oldServerIP=%%%%b"
echo )
echo if defined oldServerIP (
echo     echo Old Server IP: %%oldServerIP%%
echo     (for /f "usebackq tokens=*" %%%%a in ("%%filePath%%") do (
echo         set "line=%%%%a"
echo         set "line=!line:%%oldServerIP%%=%%newIP%%!"
echo         echo !line!
echo     )) > "%%filePath%%.tmp"
echo     move /y "%%filePath%%.tmp" "%%filePath%%"
echo     echo Server IP has been updated to %%newIP%%.
echo ) else (
echo     echo Failed to find the current server IP in the file.
echo )
echo.
echo endlocal
echo pause
) > "%userprofile%\Desktop\change_server.bat"